<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}ì¤‘ê³ ê±°ë˜ í”Œë«í¼{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" crossorigin="anonymous"></script>
</head>
<body>

  <nav>
    <h1>MyMarket</h1>
    {% if session.get('user_id') %}
      <a href="{{ url_for('dashboard') }}">ğŸ  ëŒ€ì‹œë³´ë“œ</a>
      <a href="{{ url_for('my_products') }}">ğŸ“¦ ë‚´ ìƒí’ˆ</a>
      <a href="{{ url_for('profile') }}">ğŸ‘¤ í”„ë¡œí•„</a>
      <a href="{{ url_for('chat_list') }}">ğŸ’Œ ì±„íŒ…</a>
      <a href="{{ url_for('transaction_history') }}">ğŸ“œ ê±°ë˜ë‚´ì—­</a>
      <a href="{{ url_for('logout') }}">ğŸšª ë¡œê·¸ì•„ì›ƒ</a>
      {% if user and user.username == 'admin' %}
        <hr>
        <strong style="color: #ffcc00;">ê´€ë¦¬ì ë©”ë‰´</strong>
        <a href="{{ url_for('report_list') }}">ğŸš¨ ì‹ ê³  ëª©ë¡ ë³´ê¸°</a>
        <a href="{{ url_for('suspended_users') }}">ğŸ˜´ íœ´ë©´ ê³„ì • ê´€ë¦¬</a>
      {% endif %}
    {% else %}
      <a href="{{ url_for('login') }}">ğŸ” ë¡œê·¸ì¸</a>
      <a href="{{ url_for('register') }}">ğŸ“ íšŒì›ê°€ì…</a>
    {% endif %}
  </nav>
  
  <div class="container">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash">
          {% for message in messages %}
            <p>{{ message }}</p>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </div>

  <script>
    const socket = io();

    socket.on('connect', () => {
      console.log("ğŸ“¡ ì±„íŒ… ì„œë²„ ì—°ê²°ë¨");
    });

    socket.on('broadcast_message', data => {
      const div = document.createElement('div');
      const username = document.createTextNode(data.username + ": ");
      const msg = document.createTextNode(data.message);
      div.appendChild(username);
      div.appendChild(msg);
      document.getElementById('chat-messages').appendChild(div);
      div.scrollIntoView();
    });

    function sendMessage() {
      const input = document.getElementById('chat-input');
      const msg = input.value.trim();
      if (msg) {
        socket.emit('send_message', {
          username: "{{ user.username | e if user else 'ìµëª…' }}",
          message: msg
        });
        input.value = '';
      }
    }
  </script>

</body>
</html>
